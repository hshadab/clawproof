<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClawProof: zkML for OpenClaw agents powered by Jolt Atlas</title>
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        /* Dark palette (default) â€” warm orange-tinted */
        :root, [data-theme="dark"] {
            --bg: #141518; --bg2: #1c1e24; --bg3: #26292f;
            --border: #36393f; --border-light: #2a2d33;
            --text: #d8dce4; --text2: #9aa0ac; --text3: #5e6370;
            --accent: #f0883e; --accent-h: #d2691e;
            --accent-subtle: rgba(240,136,62,0.08);
            --accent-border: rgba(240,136,62,0.2);
            --link: #64b5f6;
            --green: #4eca64; --green-bg: rgba(78,202,100,0.1);
            --amber: #e0a832; --amber-bg: rgba(224,168,50,0.12);
            --red: #f85149; --red-bg: rgba(248,81,73,0.1);
            --mono: 'SF Mono', 'Fira Code', Menlo, monospace;
        }

        /* Light palette */
        [data-theme="light"] {
            --bg: #ffffff; --bg2: #f7f8fa; --bg3: #eef0f4;
            --border: #d8dce3; --border-light: #e8ebf0;
            --text: #111827; --text2: #4b5563; --text3: #9ca3af;
            --accent: #f0883e; --accent-h: #d2691e;
            --link: #2563eb;
            --green: #16a34a; --green-bg: #f0fdf4;
            --amber: #d97706; --amber-bg: #fffbeb;
            --red: #dc2626; --red-bg: #fef2f2;
        }

        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); -webkit-font-smoothing: antialiased; transition: background 0.2s, color 0.2s; }
        .page { max-width: 720px; margin: 0 auto; padding: 2.5rem 1.25rem 4rem; }

        /* Header */
        .header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 2rem; }
        .header-left { flex: 1; }
        .wordmark { font-size: 1.25rem; font-weight: 700; letter-spacing: -0.02em; }
        .wordmark span { color: var(--text3); font-weight: 400; font-size: 1rem; }
        .tagline { color: var(--text2); font-size: 0.875rem; margin-top: 0.25rem; line-height: 1.5; }
        .theme-toggle { background: var(--bg2); border: 1px solid var(--border); border-radius: 6px; padding: 0.375rem 0.625rem; cursor: pointer; font-size: 1rem; color: var(--text); transition: background 0.15s, border-color 0.15s; line-height: 1; }
        .theme-toggle:hover { border-color: var(--accent); }

        /* Tabs */
        .tabs { display: flex; gap: 0; border-bottom: 1px solid var(--border); margin-bottom: 1.5rem; }
        .tab { padding: 0.5rem 1rem; font-size: 0.8125rem; font-weight: 500; color: var(--text3); background: none; border: none; cursor: pointer; border-bottom: 2px solid transparent; transition: color 0.15s, border-color 0.15s; }
        .tab:hover { color: var(--text2); }
        .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Stat cards */
        .stats-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.625rem; margin-bottom: 1.5rem; }
        .stat-card { background: var(--bg2); border: 1px solid var(--border-light); border-top: 2px solid var(--accent); border-radius: 8px; padding: 0.75rem; text-align: center; }
        .stat-value { font-size: 1.25rem; font-weight: 700; font-family: var(--mono); }
        .stat-label { color: var(--text2); font-size: 0.6875rem; margin-top: 0.125rem; text-transform: uppercase; letter-spacing: 0.05em; }

        /* Proof history table */
        .section-title { font-size: 0.875rem; font-weight: 600; margin-bottom: 0.75rem; }
        .history-table { width: 100%; border-collapse: collapse; font-size: 0.8125rem; }
        .history-table th { text-align: left; padding: 0.5rem 0.625rem; color: var(--text2); font-weight: 500; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid var(--border); }
        .history-table td { padding: 0.5rem 0.625rem; border-bottom: 1px solid var(--border-light); }
        .history-table tr:hover td { background: var(--bg2); }
        .history-table a { color: var(--link); text-decoration: none; font-family: var(--mono); font-size: 0.75rem; }
        .history-table a:hover { text-decoration: underline; }
        .empty-state { text-align: center; color: var(--text3); font-size: 0.8125rem; padding: 2rem 0; }

        /* Status dot */
        .dot { display: inline-block; width: 6px; height: 6px; border-radius: 50%; margin-right: 0.375rem; vertical-align: middle; }
        .dot.proving { background: var(--amber); animation: pulse 1.5s ease-in-out infinite; }
        .dot.verified { background: var(--green); }
        .dot.failed { background: var(--red); }
        @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.4; } }
        .status-text { font-size: 0.75rem; vertical-align: middle; }

        /* Per-model bar chart */
        .model-breakdown { margin-top: 1.5rem; }
        .bar-row { display: flex; align-items: center; margin-bottom: 0.5rem; }
        .bar-label { width: 120px; font-size: 0.75rem; color: var(--text2); font-family: var(--mono); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex-shrink: 0; }
        .bar-track { flex: 1; height: 16px; background: var(--bg3); border-radius: 4px; overflow: hidden; margin: 0 0.5rem; }
        .bar-fill { height: 100%; background: var(--accent); border-radius: 4px; transition: width 0.3s ease; }
        .bar-count { font-size: 0.75rem; font-family: var(--mono); color: var(--text2); width: 36px; text-align: right; flex-shrink: 0; }

        /* Demo banner */
        .demo { background: var(--bg2); border: 1px solid var(--border-light); border-radius: 10px; padding: 1.5rem; margin-bottom: 2rem; text-align: center; }
        .demo h2 { font-size: 0.9375rem; font-weight: 600; margin-bottom: 0.5rem; }
        .demo p { color: var(--text2); font-size: 0.8125rem; margin-bottom: 1rem; line-height: 1.5; }
        .demo-btn { display: inline-block; padding: 0.625rem 1.5rem; background: var(--accent); color: #fff; border: none; border-radius: 6px; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: background 0.15s; }
        .demo-btn:hover { background: var(--accent-h); }
        .demo-btn:disabled { background: var(--bg3); color: var(--text3); cursor: not-allowed; }
        .demo-result { margin-top: 1rem; display: none; }
        .demo-label { font-size: 1.125rem; font-weight: 600; }
        .demo-meta { color: var(--text3); font-size: 0.75rem; margin-top: 0.25rem; }
        .demo-status { display: inline-flex; align-items: center; gap: 0.375rem; margin-top: 0.5rem; font-size: 0.8125rem; font-weight: 500; }
        .demo-link { display: inline-block; margin-top: 0.5rem; font-family: var(--mono); font-size: 0.6875rem; color: var(--link); text-decoration: none; }
        .demo-link:hover { text-decoration: underline; }

        /* Model cards */
        .models-grid { display: grid; gap: 0.75rem; }
        .model-card { border: 1px solid var(--border-light); border-radius: 8px; padding: 1rem; cursor: pointer; transition: border-color 0.15s, box-shadow 0.15s; background: var(--bg2); }
        .model-card:hover { border-color: var(--accent); }
        .model-card.selected { border-color: var(--accent); background: var(--bg3); box-shadow: 0 0 0 1px var(--accent-border); }
        .model-card h3 { font-size: 0.875rem; font-weight: 600; }
        .model-card .desc { color: var(--text2); font-size: 0.75rem; margin-top: 0.25rem; line-height: 1.4; }
        .model-card .meta { color: var(--text3); font-size: 0.6875rem; margin-top: 0.5rem; font-family: var(--mono); }

        /* Form elements */
        .form-group { margin-bottom: 1rem; }
        .form-label { display: block; font-size: 0.8125rem; font-weight: 500; color: var(--text2); margin-bottom: 0.375rem; }
        select, textarea, input[type="number"], input[type="text"], input[type="file"] {
            width: 100%; padding: 0.5rem 0.625rem; background: var(--bg); border: 1px solid var(--border);
            border-radius: 6px; color: var(--text); font-size: 0.875rem; font-family: inherit; outline: none;
            transition: border-color 0.15s; line-height: 1.5;
        }
        select:focus, textarea:focus, input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(240,136,62,0.15); }
        textarea { resize: vertical; min-height: 72px; }
        .fields-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
        .field-item .form-label { font-size: 0.75rem; }
        .field-range { color: var(--text3); font-weight: 400; }
        .field-item input { padding: 0.4375rem 0.5rem; font-size: 0.8125rem; }
        .submit-btn { width: 100%; padding: 0.625rem; background: var(--accent); color: #fff; border: none; border-radius: 6px; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: background 0.15s; margin-top: 0.5rem; }
        .submit-btn:hover { background: var(--accent-h); }
        .submit-btn:disabled { background: var(--bg3); color: var(--text3); cursor: not-allowed; }
        .error-msg { color: var(--red); font-size: 0.8125rem; text-align: center; margin-top: 0.75rem; }

        /* Result card */
        .result-card { border: 1px solid var(--border); border-radius: 8px; overflow: hidden; margin-top: 1rem; display: none; }
        .result-top { padding: 1rem; text-align: center; }
        .result-prediction { font-size: 1.125rem; font-weight: 600; }
        .result-confidence { color: var(--text3); font-size: 0.8125rem; margin-top: 0.125rem; }
        .result-bottom { display: flex; align-items: center; justify-content: space-between; padding: 0.625rem 1rem; background: var(--bg2); border-top: 1px solid var(--border-light); }

        /* Upload zone */
        .upload-zone { border: 2px dashed var(--border); border-radius: 8px; padding: 2rem; text-align: center; cursor: pointer; transition: border-color 0.15s, background 0.15s; }
        .upload-zone:hover { border-color: var(--accent); background: var(--bg2); }
        .upload-zone.dragover { border-color: var(--accent); background: var(--bg2); }
        .upload-zone h3 { font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem; }
        .upload-zone p { color: var(--text3); font-size: 0.75rem; }
        .upload-zone input { display: none; }

        /* Agent code blocks */
        pre { font-family: var(--mono); font-size: 0.6875rem; background: var(--bg2); border: 1px solid var(--border-light); border-radius: 6px; padding: 0.75rem; overflow-x: auto; margin: 0.5rem 0; line-height: 1.6; color: var(--text); }
        code { font-family: var(--mono); font-size: 0.75rem; background: var(--bg3); padding: 0.125rem 0.375rem; border-radius: 3px; }
        .agent-section h4 { font-size: 0.8125rem; font-weight: 600; margin: 1rem 0 0.375rem; }
        .agent-section h4:first-child { margin-top: 0; }
        .agent-section p { color: var(--text2); font-size: 0.8125rem; line-height: 1.6; }

        /* Supported ops */
        .ops-section { margin-top: 1.5rem; border-top: 1px solid var(--border-light); padding-top: 1rem; }
        .ops-section h4 { font-size: 0.8125rem; font-weight: 600; margin-bottom: 0.5rem; }
        .ops-section h5 { font-size: 0.75rem; font-weight: 600; color: var(--text2); margin: 0.75rem 0 0.25rem; }
        .ops-list { list-style: none; padding: 0; }
        .ops-list li { font-size: 0.75rem; color: var(--text2); padding: 0.125rem 0; font-family: var(--mono); }
        .ops-list li::before { content: "\2022"; color: var(--accent); margin-right: 0.5rem; }

        /* Footer */
        .footer { text-align: center; margin-top: 2.5rem; padding-top: 1rem; border-top: 1px solid var(--border-light); color: var(--text3); font-size: 0.6875rem; }
        .footer a { color: var(--text3); text-decoration: none; }
        .footer a:hover { color: var(--text2); }

        /* Responsive */
        @media (max-width: 600px) {
            .stats-row { grid-template-columns: repeat(3, 1fr); }
            .fields-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
<div class="page">
    <div class="header">
        <div class="header-left">
            <div class="wordmark">ClawProof: <span>zkML for OpenClaw agents powered by <a href="https://github.com/ICME-Lab/jolt-atlas" style="color:var(--link);text-decoration:none;font-weight:400" target="_blank">Jolt Atlas</a></span></div>
            <p class="tagline">Zero-knowledge proofs of ML inference. No API keys, no auth. Bring your own model or use ours.</p>
        </div>
        <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()" title="Toggle dark/light mode"></button>
    </div>

    <!-- Tabs -->
    <div class="tabs">
        <button class="tab active" onclick="switchTab('dashboard')">Dashboard</button>
        <button class="tab" onclick="switchTab('prove')">Prove</button>
        <button class="tab" onclick="switchTab('upload')">Upload</button>
        <button class="tab" onclick="switchTab('api')">API</button>
    </div>

    <!-- Tab: Dashboard -->
    <div class="tab-content active" id="tab-dashboard">
        <div class="stats-row" id="stats-row">
            <div class="stat-card"><div class="stat-value" id="stat-total">-</div><div class="stat-label">Total Proofs</div></div>
            <div class="stat-card"><div class="stat-value" id="stat-verified">-</div><div class="stat-label">Verified</div></div>
            <div class="stat-card"><div class="stat-value" id="stat-proving">-</div><div class="stat-label">Proving</div></div>
            <div class="stat-card"><div class="stat-value" id="stat-avg-prove">-</div><div class="stat-label">Avg Prove</div></div>
            <div class="stat-card"><div class="stat-value" id="stat-avg-verify">-</div><div class="stat-label">Avg Verify</div></div>
        </div>

        <div class="section-title">Proof History</div>
        <table class="history-table">
            <thead>
                <tr><th>Time</th><th>Model</th><th>Result</th><th>Confidence</th><th>Status</th><th>Prove Time</th></tr>
            </thead>
            <tbody id="history-body">
                <tr><td colspan="6" class="empty-state">Loading...</td></tr>
            </tbody>
        </table>

        <div class="model-breakdown" id="model-breakdown"></div>
    </div>

    <!-- Tab: Prove -->
    <div class="tab-content" id="tab-prove">
        <!-- One-click demo -->
        <div class="demo">
            <h2>See it work</h2>
            <p>Generate a real SNARK proof in one click. Pick a model and we'll prove the inference cryptographically.</p>
            <div style="display:flex;gap:0.5rem;justify-content:center;margin-bottom:0.75rem;">
                <button class="demo-btn" id="demo-btn-auth" onclick="runDemo('authorization')" style="font-size:0.8125rem;padding:0.5rem 1rem;">Authorize a Transaction</button>
                <button class="demo-btn" id="demo-btn-trust" onclick="runDemo('agent_trust')" style="font-size:0.8125rem;padding:0.5rem 1rem;">Score Agent Trust</button>
            </div>
            <div class="demo-result" id="demo-result">
                <div class="demo-label" id="demo-label"></div>
                <div class="demo-meta" id="demo-confidence"></div>
                <div class="demo-status">
                    <span class="dot" id="demo-dot"></span>
                    <span id="demo-status-text"></span>
                </div>
                <br>
                <a class="demo-link" id="demo-link" target="_blank"></a>
            </div>
        </div>

        <div class="models-grid" id="models-grid">Loading models...</div>
        <div id="input-area" style="margin-top:1rem;"></div>
        <button class="submit-btn" id="prove-btn" disabled onclick="prove()">Generate proof</button>
        <div id="error" class="error-msg"></div>
        <div class="result-card" id="result">
            <div class="result-top">
                <div class="result-prediction" id="res-label"></div>
                <div class="result-confidence" id="res-confidence"></div>
            </div>
            <div class="result-bottom">
                <div class="demo-status"><span class="dot" id="res-dot"></span><span id="res-status-text"></span></div>
                <a class="demo-link" id="res-link" target="_blank"></a>
            </div>
        </div>
    </div>

    <!-- Tab: Upload -->
    <div class="tab-content" id="tab-upload">
        <div class="upload-zone" id="upload-zone" onclick="document.getElementById('upload-file').click()">
            <h3>Drop an ONNX model here</h3>
            <p>or click to browse &middot; max 5MB &middot; .onnx, .pt, .pkl</p>
            <input type="file" id="upload-file" accept=".onnx,.pt,.pth,.pkl,.pb">
        </div>
        <div id="upload-form" style="display:none; margin-top:1rem;">
            <p style="font-size:0.8125rem; color:var(--text2); margin-bottom:1rem;" id="upload-filename"></p>
            <div class="form-group">
                <label class="form-label">Model name</label>
                <input type="text" id="up-name" placeholder="My model">
            </div>
            <div class="form-group">
                <label class="form-label">Input vector (JSON array of integers)</label>
                <textarea id="up-input" placeholder="[0, 1, 2, 3, ...]" rows="3"></textarea>
            </div>
            <div class="fields-grid">
                <div class="form-group">
                    <label class="form-label">Labels (JSON array)</label>
                    <input type="text" id="up-labels" placeholder='["class_a", "class_b"]'>
                </div>
                <div class="form-group">
                    <label class="form-label">Trace length</label>
                    <input type="number" id="up-trace" value="16384" min="4096" step="1">
                </div>
            </div>
            <button class="submit-btn" id="upload-prove-btn" onclick="uploadAndProve()">Upload &amp; prove</button>
            <div id="upload-error" class="error-msg"></div>
            <div class="result-card" id="upload-result">
                <div class="result-top">
                    <div class="result-prediction" id="up-res-label"></div>
                    <div class="result-confidence" id="up-res-confidence"></div>
                </div>
                <div class="result-bottom">
                    <div class="demo-status"><span class="dot" id="up-res-dot"></span><span id="up-res-status-text"></span></div>
                    <a class="demo-link" id="up-res-link" target="_blank"></a>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab: API -->
    <div class="tab-content" id="tab-api">
        <div class="agent-section">
            <h4>One-call proof (curl)</h4>
<pre>curl -X POST https://clawproof.onrender.com/prove \
  -H "Content-Type: application/json" \
  -d '{"model_id":"sentiment","input":{"text":"The stock market rallied today"}}'</pre>

            <h4>Agent trust scoring</h4>
<pre>curl -X POST https://clawproof.onrender.com/prove \
  -H "Content-Type: application/json" \
  -d '{"model_id":"agent_trust","input":{"fields":{"karma":8,"account_age":5,"follower_ratio":3,"post_frequency":2,"verification":2,"content_similarity":0,"interaction_type":1}}}'</pre>

            <h4>Upload &amp; prove your own model</h4>
<pre>curl -X POST https://clawproof.onrender.com/prove/model \
  -F "onnx_file=@model.onnx" \
  -F "input_raw=[0, 1, 2, 3]" \
  -F "input_dim=4" \
  -F 'labels=["yes","no"]'</pre>

            <h4>Install the skill (OpenClaw / Moltbook)</h4>
<pre>https://raw.githubusercontent.com/hshadab/clawproof/main/SKILL.md</pre>

            <h4>Python SDK</h4>
<pre>pip install clawproof

from clawproof import ClawProof
cp = ClawProof()
receipt = cp.prove_and_wait("sentiment",
    text="The stock market rallied today")
print(receipt.output.label)</pre>

            <h4>JavaScript SDK</h4>
<pre>npm install clawproof

import { ClawProof } from "clawproof";
const cp = new ClawProof();
const receipt = await cp.proveAndWait("sentiment", {
  text: "The stock market rallied today"
});</pre>

            <h4>MCP (Claude Desktop)</h4>
<pre>{
  "mcpServers": {
    "clawproof": {
      "command": "clawproof-mcp",
      "env": { "CLAWPROOF_URL": "https://clawproof.onrender.com" }
    }
  }
}</pre>

            <h4>Endpoints</h4>
            <p>
                <code>GET /models</code> &middot;
                <code>POST /prove</code> &middot;
                <code>POST /prove/model</code> &middot;
                <code>POST /prove/batch</code> &middot;
                <code>GET /receipt/{id}</code> &middot;
                <code>GET /receipts/recent</code> &middot;
                <code>POST /verify</code> &middot;
                <code>GET /badge/{id}</code> &middot;
                <code>GET /metrics</code> &middot;
                <code>POST /models/upload</code> &middot;
                <code>GET /openapi.json</code>
            </p>
        </div>

        <div class="ops-section">
            <h4>Supported ONNX Operations</h4>
            <p style="font-size:0.75rem; color:var(--text2); margin-bottom:0.5rem;">ClawProof uses the <a href="https://github.com/ICME-Lab/jolt-atlas" style="color:var(--link)">JOLT-Atlas</a> proving system. The atlas-onnx-tracer compiles ONNX graphs into provable circuits. Below are the operations supported by the <code>Operator</code> enum in the tracer.</p>

            <h5>Atlas-onnx-tracer operators (26)</h5>
            <ul class="ops-list">
                <li><code>Add</code>, <code>Sub</code>, <code>Mul</code>, <code>Div</code>, <code>Neg</code></li>
                <li><code>ReLU</code>, <code>Tanh</code>, <code>Erf</code></li>
                <li><code>SoftmaxAxes</code> (scaled, axis-aware)</li>
                <li><code>Einsum</code> (covers MatMul, Gemm, batched attention)</li>
                <li><code>Sum</code> (reduction over axes)</li>
                <li><code>Reshape</code>, <code>Broadcast</code>, <code>MoveAxis</code></li>
                <li><code>Gather</code>, <code>Identity</code>, <code>Constant</code>, <code>Input</code></li>
                <li><code>Square</code>, <code>Cube</code>, <code>Rsqrt</code></li>
                <li><code>ScalarConstDiv</code>, <code>Clamp</code></li>
                <li><code>And</code>, <code>Iff</code>, <code>IsNan</code></li>
            </ul>

            <h5>Extended ops (onnx-tracer pipeline)</h5>
            <p style="font-size:0.75rem; color:var(--text2); margin-bottom:0.25rem;">The full onnx-tracer supports a much wider set via polynomial, lookup-table, and hybrid op categories:</p>
            <ul class="ops-list">
                <li><strong>Arithmetic:</strong> <code>Add</code>, <code>Sub</code>, <code>Mul</code>, <code>Div</code>, <code>Neg</code>, <code>Pow</code>, <code>Prod</code></li>
                <li><strong>Activations:</strong> <code>ReLU</code>, <code>LeakyReLU</code>, <code>Sigmoid</code>, <code>Tanh</code>, <code>Erf</code></li>
                <li><strong>Trig:</strong> <code>Sin</code>, <code>Cos</code>, <code>Tan</code>, <code>ASin</code>, <code>ACos</code>, <code>ATan</code>, <code>Sinh</code>, <code>Cosh</code></li>
                <li><strong>Math:</strong> <code>Exp</code>, <code>Ln</code>, <code>Sqrt</code>, <code>Rsqrt</code>, <code>Abs</code>, <code>Sign</code>, <code>Ceil</code>, <code>Floor</code>, <code>Round</code></li>
                <li><strong>Comparison:</strong> <code>Greater</code>, <code>GreaterEqual</code>, <code>Less</code>, <code>LessEqual</code>, <code>Equals</code></li>
                <li><strong>Reduction:</strong> <code>Sum</code>, <code>ReduceMax</code>, <code>ReduceMin</code>, <code>ReduceArgMax</code>, <code>ReduceArgMin</code>, <code>TopK</code></li>
                <li><strong>Pooling:</strong> <code>MaxPool2d</code>, <code>SumPool</code>, <code>GlobalSumPool</code></li>
                <li><strong>Conv:</strong> <code>Conv</code>, <code>DeConv</code>, <code>Downsample</code></li>
                <li><strong>Shape:</strong> <code>Reshape</code>, <code>Flatten</code>, <code>MoveAxis</code>, <code>Pad</code>, <code>Concat</code>, <code>Slice</code>, <code>Resize</code></li>
                <li><strong>Indexing:</strong> <code>Gather</code>, <code>GatherElements</code>, <code>ScatterElements</code>, <code>OneHot</code></li>
                <li><strong>Logic:</strong> <code>And</code>, <code>Or</code>, <code>Xor</code>, <code>Not</code>, <code>Iff</code></li>
                <li><strong>Attention:</strong> <code>Einsum</code>, <code>Softmax</code></li>
            </ul>

            <h5>Model constraints</h5>
            <ul class="ops-list">
                <li>ONNX format only (convert from PyTorch/TensorFlow/sklearn via <code>/convert</code>)</li>
                <li>Max ONNX file size: 5MB</li>
                <li>All inputs are cast to integer (i32) tensors</li>
                <li>Trace length must accommodate model complexity (default 2<sup>14</sup>)</li>
            </ul>

            <h5>Conversion notes (<code>/convert</code>)</h5>
            <ul class="ops-list">
                <li>Conversion produces ONNX but does not guarantee the model fits in the trace length budget</li>
                <li>PyTorch models should be traced (<code>torch.jit.trace</code>) before upload</li>
                <li>sklearn models: LogisticRegression, MLPClassifier, DecisionTree, etc.</li>
                <li>TensorFlow/Keras models with custom layers may fail conversion</li>
            </ul>
            <p style="font-size:0.75rem; color:var(--text2); margin-top:0.5rem;">For the full operator source, see <a href="https://github.com/ICME-Lab/jolt-atlas/tree/main/atlas-onnx-tracer/src/ops" style="color:var(--link)">atlas-onnx-tracer/src/ops</a> and <a href="https://github.com/ICME-Lab/jolt-atlas/tree/main/onnx-tracer/src/ops" style="color:var(--link)">onnx-tracer/src/ops</a>.</p>
        </div>
    </div>

    <div class="footer">
        <a href="https://github.com/hshadab/clawproof">GitHub</a> &middot;
        <a href="/openapi.json">OpenAPI</a> &middot;
        <a href="https://github.com/ICME-Lab/jolt-atlas">JOLT-Atlas</a> &middot;
        Open source (MIT)
    </div>
</div>

<script>
let models = [];
let selectedModel = null;
let dashboardTimer = null;

// --- Theme ---
function initTheme() {
    const saved = localStorage.getItem('cp-theme');
    const theme = saved || 'dark';
    document.documentElement.setAttribute('data-theme', theme);
    updateToggleIcon(theme);
}

function toggleTheme() {
    const current = document.documentElement.getAttribute('data-theme');
    const next = current === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', next);
    localStorage.setItem('cp-theme', next);
    updateToggleIcon(next);
}

function updateToggleIcon(theme) {
    document.getElementById('theme-toggle').textContent = theme === 'dark' ? '\u2600' : '\u263E';
}

initTheme();

// --- Tabs ---
function switchTab(name) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.querySelector('.tab-content#tab-' + name).classList.add('active');
    event.target.classList.add('active');
    if (name === 'dashboard') loadDashboard();
}

// --- Dashboard ---
async function loadDashboard() {
    try {
        const [metricsRes, recentRes] = await Promise.all([
            fetch('/metrics'),
            fetch('/receipts/recent?limit=20')
        ]);
        const metrics = await metricsRes.json();
        const recent = await recentRes.json();

        // Stats
        document.getElementById('stat-total').textContent = metrics.total_proofs || 0;
        document.getElementById('stat-verified').textContent = metrics.verified || 0;
        document.getElementById('stat-proving').textContent = metrics.proving || 0;
        document.getElementById('stat-avg-prove').textContent = metrics.avg_prove_time_ms ? (metrics.avg_prove_time_ms / 1000).toFixed(1) + 's' : '-';
        document.getElementById('stat-avg-verify').textContent = metrics.avg_verify_time_ms ? metrics.avg_verify_time_ms.toFixed(0) + 'ms' : '-';

        // History table
        const tbody = document.getElementById('history-body');
        if (recent.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="empty-state">No proofs yet. Go to the Prove tab to generate one.</td></tr>';
        } else {
            tbody.innerHTML = recent.map(r => {
                const time = new Date(r.created_at);
                const timeStr = time.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
                const dateStr = time.toLocaleDateString([], {month:'short', day:'numeric'});
                const statusClass = r.status;
                const statusLabel = r.status === 'verified' ? 'Verified' : r.status === 'proving' ? 'Proving' : 'Failed';
                const proveTime = r.prove_time_ms ? (r.prove_time_ms / 1000).toFixed(1) + 's' : '-';
                const conf = (r.confidence * 100).toFixed(1) + '%';
                return '<tr>' +
                    '<td style="font-size:0.75rem;color:var(--text2)">' + dateStr + ' ' + timeStr + '</td>' +
                    '<td style="font-family:var(--mono);font-size:0.75rem">' + r.model_name + '</td>' +
                    '<td><a href="/receipt/' + r.id + '">' + r.label + '</a></td>' +
                    '<td style="font-family:var(--mono);font-size:0.75rem">' + conf + '</td>' +
                    '<td><span class="dot ' + statusClass + '"></span><span class="status-text">' + statusLabel + '</span></td>' +
                    '<td style="font-family:var(--mono);font-size:0.75rem">' + proveTime + '</td>' +
                    '</tr>';
            }).join('');
        }

        // Per-model breakdown
        const breakdown = document.getElementById('model-breakdown');
        const byModel = metrics.by_model || {};
        const entries = Object.entries(byModel).sort((a, b) => b[1] - a[1]);
        if (entries.length > 0) {
            const maxCount = entries[0][1];
            breakdown.innerHTML = '<div class="section-title" style="margin-top:1.5rem">Per-Model Breakdown</div>' +
                entries.map(([name, count]) => {
                    const pct = maxCount > 0 ? (count / maxCount * 100) : 0;
                    return '<div class="bar-row">' +
                        '<span class="bar-label">' + name + '</span>' +
                        '<div class="bar-track"><div class="bar-fill" style="width:' + pct + '%"></div></div>' +
                        '<span class="bar-count">' + count + '</span>' +
                        '</div>';
                }).join('');
        } else {
            breakdown.innerHTML = '';
        }
    } catch (e) {
        document.getElementById('history-body').innerHTML = '<tr><td colspan="6" class="empty-state">Failed to load dashboard data.</td></tr>';
    }
}

// Auto-refresh dashboard every 30s
function startDashboardRefresh() {
    loadDashboard();
    dashboardTimer = setInterval(loadDashboard, 30000);
}

// --- Demo ---
const DEMO_PAYLOADS = {
    authorization: {model_id:'authorization',input:{fields:{budget:13,trust:3,amount:4,category:1,velocity:1,day:2,time:0}}},
    agent_trust: {model_id:'agent_trust',input:{fields:{karma:8,account_age:5,follower_ratio:3,post_frequency:2,verification:2,content_similarity:0,interaction_type:1}}}
};

async function runDemo(modelId) {
    const btnAuth = document.getElementById('demo-btn-auth');
    const btnTrust = document.getElementById('demo-btn-trust');
    const res = document.getElementById('demo-result');
    btnAuth.disabled = true; btnTrust.disabled = true;
    const activeBtn = modelId === 'agent_trust' ? btnTrust : btnAuth;
    activeBtn.textContent = 'Proving...';
    res.style.display = 'none';

    try {
        const payload = DEMO_PAYLOADS[modelId] || DEMO_PAYLOADS.authorization;
        const r = await fetch('/prove', {
            method: 'POST', headers: {'Content-Type':'application/json'},
            body: JSON.stringify(payload)
        });
        const data = await r.json();
        if (!r.ok) throw new Error(data.error || 'Request failed');

        document.getElementById('demo-label').textContent = data.output.label;
        document.getElementById('demo-confidence').textContent = (data.output.confidence * 100).toFixed(1) + '% confidence';
        setDot('demo-dot', 'demo-status-text', 'proving');
        const link = document.getElementById('demo-link');
        link.href = '/receipt/' + data.receipt_id;
        link.textContent = 'View receipt';
        res.style.display = 'block';

        pollReceipt(data.receipt_id, 'demo-dot', 'demo-status-text');
    } catch(e) {
        res.style.display = 'block';
        document.getElementById('demo-label').textContent = 'Error';
        document.getElementById('demo-confidence').textContent = e.message;
    }
    btnAuth.disabled = false; btnAuth.textContent = 'Authorize a Transaction';
    btnTrust.disabled = false; btnTrust.textContent = 'Score Agent Trust';
}

function setDot(dotId, textId, status) {
    const dot = document.getElementById(dotId);
    const text = document.getElementById(textId);
    dot.className = 'dot ' + status;
    text.textContent = status === 'proving' ? 'Proving...' : status === 'verified' ? 'Verified' : 'Failed';
    text.style.color = status === 'proving' ? 'var(--amber)' : status === 'verified' ? 'var(--green)' : 'var(--red)';
}

function pollReceipt(id, dotId, textId) {
    const timer = setInterval(async () => {
        try {
            const r = await fetch('/receipt/' + id, {headers:{Accept:'application/json'}});
            if (!r.ok) return;
            const data = await r.json();
            if (data.status === 'verified') { clearInterval(timer); setDot(dotId, textId, 'verified'); }
            else if (data.status === 'failed') { clearInterval(timer); setDot(dotId, textId, 'failed'); }
        } catch(e) { clearInterval(timer); setDot(dotId, textId, 'failed'); }
    }, 3000);
}

// --- Models ---
async function init() {
    try {
        const res = await fetch('/models');
        models = await res.json();
        renderModelCards();
        if (models.length > 0) selectModel(models[0].id);
    } catch(e) {
        document.getElementById('models-grid').textContent = 'Failed to load models.';
    }
}

function renderModelCards() {
    const grid = document.getElementById('models-grid');
    grid.innerHTML = models.map(m =>
        '<div class="model-card" id="card-' + m.id + '" onclick="selectModel(\'' + m.id + '\')">' +
            '<h3>' + m.name + '</h3>' +
            '<div class="desc">' + m.description + '</div>' +
            '<div class="meta">' + m.input_type + ' \u00B7 ' + m.labels.join(' / ') + ' \u00B7 trace ' + m.trace_length + '</div>' +
        '</div>'
    ).join('');
}

function selectModel(id) {
    selectedModel = models.find(m => m.id === id);
    document.querySelectorAll('.model-card').forEach(c => c.classList.remove('selected'));
    const card = document.getElementById('card-' + id);
    if (card) card.classList.add('selected');
    renderInputs();
    document.getElementById('prove-btn').disabled = false;
}

const MODEL_DEFAULTS = {
    sentiment: { text: "The economy showed strong growth this quarter as tech stocks surged" },
    spam_detector: { raw: [1, 0, 3, 2, 1, 0, 2, 1] },
    authorization: { fields: { budget: 13, trust: 3, amount: 4, category: 1, velocity: 1, day: 2, time: 0 } },
    agent_trust: { fields: { karma: 8, account_age: 5, follower_ratio: 3, post_frequency: 2, verification: 2, content_similarity: 0, interaction_type: 1 } }
};

function renderInputs() {
    const m = selectedModel;
    if (!m) return;
    const area = document.getElementById('input-area');
    const defaults = MODEL_DEFAULTS[m.id] || {};
    if (m.input_type === 'text') {
        const val = defaults.text || '';
        area.innerHTML = '<div class="form-group"><label class="form-label">Input text</label><textarea id="text-input" placeholder="Enter text to classify...">' + val + '</textarea></div>';
    } else if (m.fields) {
        let html = '<div class="form-group"><label class="form-label">Parameters</label><div class="fields-grid">';
        for (const f of m.fields) {
            const val = (defaults.fields && defaults.fields[f.name] !== undefined) ? defaults.fields[f.name] : f.min;
            html += '<div class="field-item"><label class="form-label">' + f.name + ' <span class="field-range">' + f.min + '\u2013' + f.max + '</span></label><input type="number" data-field="' + f.name + '" min="' + f.min + '" max="' + f.max + '" value="' + val + '"></div>';
        }
        html += '</div></div>';
        area.innerHTML = html;
    } else if (m.input_type === 'raw') {
        const val = defaults.raw ? JSON.stringify(defaults.raw) : '';
        area.innerHTML = '<div class="form-group"><label class="form-label">Raw input vector (JSON array of ' + m.input_dim + ' integers)</label><textarea id="raw-input" placeholder="[0, 1, 2, ...]" rows="3">' + val + '</textarea></div>';
    }
}

// --- Prove ---
async function prove() {
    const btn = document.getElementById('prove-btn');
    const errEl = document.getElementById('error');
    const resEl = document.getElementById('result');
    errEl.textContent = ''; resEl.style.display = 'none';
    btn.disabled = true; btn.textContent = 'Generating...';

    const m = selectedModel;
    if (!m) return;
    let body = { model_id: m.id, input: {} };

    if (m.input_type === 'text') {
        const text = document.getElementById('text-input')?.value || '';
        if (!text.trim()) { errEl.textContent = 'Please enter some text.'; btn.disabled = false; btn.textContent = 'Generate proof'; return; }
        body.input.text = text;
    } else if (m.fields) {
        body.input.fields = {};
        for (const f of m.fields) {
            const el = document.querySelector('[data-field="' + f.name + '"]');
            const val = parseInt(el?.value || '0');
            if (val < f.min || val > f.max) { errEl.textContent = f.name + ' must be ' + f.min + '\u2013' + f.max + '.'; btn.disabled = false; btn.textContent = 'Generate proof'; return; }
            body.input.fields[f.name] = val;
        }
    } else if (m.input_type === 'raw') {
        try { body.input.raw = JSON.parse(document.getElementById('raw-input')?.value || '[]'); }
        catch(e) { errEl.textContent = 'Invalid JSON array.'; btn.disabled = false; btn.textContent = 'Generate proof'; return; }
    }

    try {
        const r = await fetch('/prove', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
        const data = await r.json();
        if (!r.ok) throw new Error(data.error || 'Failed');

        document.getElementById('res-label').textContent = data.output.label;
        document.getElementById('res-confidence').textContent = (data.output.confidence * 100).toFixed(1) + '% confidence';
        setDot('res-dot', 'res-status-text', 'proving');
        const link = document.getElementById('res-link');
        link.href = '/receipt/' + data.receipt_id; link.textContent = 'View receipt';
        resEl.style.display = 'block';
        pollReceipt(data.receipt_id, 'res-dot', 'res-status-text');
    } catch(e) { errEl.textContent = e.message; }

    btn.disabled = false; btn.textContent = 'Generate proof';
}

// --- Upload & Prove ---
const uploadZone = document.getElementById('upload-zone');
const uploadFile = document.getElementById('upload-file');
uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.classList.add('dragover'); });
uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
uploadZone.addEventListener('drop', e => { e.preventDefault(); uploadZone.classList.remove('dragover'); if (e.dataTransfer.files[0]) handleUploadFile(e.dataTransfer.files[0]); });
uploadFile.addEventListener('change', e => { if (e.target.files[0]) handleUploadFile(e.target.files[0]); });

function handleUploadFile(file) {
    window._uploadedFile = file;
    document.getElementById('upload-filename').textContent = file.name + ' (' + (file.size / 1024).toFixed(1) + ' KB)';
    document.getElementById('upload-form').style.display = 'block';
    uploadZone.style.display = 'none';
}

async function uploadAndProve() {
    const btn = document.getElementById('upload-prove-btn');
    const errEl = document.getElementById('upload-error');
    const resEl = document.getElementById('upload-result');
    errEl.textContent = ''; resEl.style.display = 'none';
    btn.disabled = true; btn.textContent = 'Uploading & proving...';

    const file = window._uploadedFile;
    if (!file) { errEl.textContent = 'No file selected.'; btn.disabled = false; btn.textContent = 'Upload & prove'; return; }

    const inputRaw = document.getElementById('up-input').value.trim();
    if (!inputRaw) { errEl.textContent = 'Input vector is required.'; btn.disabled = false; btn.textContent = 'Upload & prove'; return; }

    try { JSON.parse(inputRaw); } catch(e) { errEl.textContent = 'Invalid JSON input vector.'; btn.disabled = false; btn.textContent = 'Upload & prove'; return; }

    const form = new FormData();
    form.append('onnx_file', file);
    form.append('input_raw', inputRaw);
    form.append('input_dim', JSON.parse(inputRaw).length.toString());
    form.append('name', document.getElementById('up-name').value || 'uploaded');
    form.append('labels', document.getElementById('up-labels').value || '["class_0","class_1"]');
    form.append('trace_length', document.getElementById('up-trace').value || '16384');

    try {
        const r = await fetch('/prove/model', { method: 'POST', body: form });
        const data = await r.json();
        if (!r.ok) throw new Error(data.error || 'Failed');

        document.getElementById('up-res-label').textContent = data.output.label;
        document.getElementById('up-res-confidence').textContent = (data.output.confidence * 100).toFixed(1) + '% confidence';
        setDot('up-res-dot', 'up-res-status-text', 'proving');
        const link = document.getElementById('up-res-link');
        link.href = '/receipt/' + data.receipt_id; link.textContent = 'View receipt';
        resEl.style.display = 'block';
        pollReceipt(data.receipt_id, 'up-res-dot', 'up-res-status-text');
    } catch(e) { errEl.textContent = e.message; }

    btn.disabled = false; btn.textContent = 'Upload & prove';
}

// --- Init ---
startDashboardRefresh();
init();
</script>
</body>
</html>
