services:
  # --- Main Rust API ---
  - type: web
    name: clawproof
    runtime: docker
    repo: https://github.com/hshadab/clawproof.git
    branch: main
    plan: pro plus
    region: oregon
    healthCheckPath: /health
    buildFilter:
      paths:
        - src/**
        - Cargo.toml
        - Cargo.lock
        - Dockerfile
        - models/**
        - dory_srs_*.srs
      ignoredPaths:
        - static/**
        - converter/**
        - sdks/**
        - moltbook/**
        - "*.md"
    disk:
      name: clawproof-data
      mountPath: /app/data
      sizeGB: 1
    envVars:
      - key: RUST_LOG
        value: info
      - key: BASE_URL
        value: https://clawproof.onrender.com
      - key: DATABASE_PATH
        value: /app/data/clawproof.db
      - key: UPLOADED_MODELS_DIR
        value: /app/data/models
      - key: STATIC_DIR
        value: /app/data/static
      - key: CONVERTER_URL
        value: https://clawproof-converter.onrender.com
      - key: CORS_ORIGINS
        value: https://clawproof.onrender.com

  # --- Python ONNX converter sidecar ---
  - type: web
    name: clawproof-converter
    runtime: docker
    repo: https://github.com/hshadab/clawproof.git
    branch: main
    rootDir: converter
    plan: starter
    region: oregon
    healthCheckPath: /health
    buildFilter:
      paths:
        - converter/**
    envVars:
      - key: PORT
        value: "10000"
      - key: LOG_LEVEL
        value: info
